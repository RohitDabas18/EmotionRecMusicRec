{"cells":[{"cell_type":"code","execution_count":1,"metadata":{"executionInfo":{"elapsed":5894,"status":"ok","timestamp":1651275184837,"user":{"displayName":"Rohit Dabas","userId":"03091092264887037162"},"user_tz":360},"id":"5s4RIXmPWu_q"},"outputs":[],"source":["import os\n","import cv2\n","import numpy as np\n","import keras\n","import tensorflow as tf\n","from keras.models import Sequential\n","from keras.layers import Dense,Dropout,Activation,Flatten,BatchNormalization\n","from keras.layers import Conv2D,MaxPooling2D\n","from sklearn.utils import shuffle\n","from tensorflow.keras.applications import (vgg16,resnet50,mobilenet,inception_v3)\n","\n"," "]},{"cell_type":"code","execution_count":2,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":16956,"status":"ok","timestamp":1651275201787,"user":{"displayName":"Rohit Dabas","userId":"03091092264887037162"},"user_tz":360},"id":"IMo5LNMgcfsp","outputId":"32bc5dd7-482a-4dc3-88ad-2d8eacd11573"},"outputs":[{"name":"stdout","output_type":"stream","text":["Mounted at /content/drive\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive')"]},{"cell_type":"code","execution_count":3,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":142,"status":"ok","timestamp":1651275201924,"user":{"displayName":"Rohit Dabas","userId":"03091092264887037162"},"user_tz":360},"id":"yPXJsAJMcvWf","outputId":"1539a0d9-d8d9-4a9d-92a5-4badb4121346"},"outputs":[{"name":"stdout","output_type":"stream","text":["cp: cannot stat '/content/drive/MyDrive/MusicalMoods/Dataset1': No such file or directory\n"]}],"source":["!cp -r '/content/drive/MyDrive/MusicalMoods/Dataset1' Dataset1"]},{"cell_type":"code","execution_count":4,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":214,"status":"ok","timestamp":1651275202136,"user":{"displayName":"Rohit Dabas","userId":"03091092264887037162"},"user_tz":360},"id":"TrcwWI12Os3b","outputId":"86693407-326f-4a51-a352-3c8ed03d1e8b"},"outputs":[{"name":"stdout","output_type":"stream","text":["cp: cannot stat '/content/drive/MyDrive/MusicalMoods/Val_Dataset_CK+': No such file or directory\n"]}],"source":["!cp -r '/content/drive/MyDrive/MusicalMoods/Val_Dataset_CK+' Val_Dataset_CK+"]},{"cell_type":"code","execution_count":5,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":110,"status":"ok","timestamp":1651275202243,"user":{"displayName":"Rohit Dabas","userId":"03091092264887037162"},"user_tz":360},"id":"iKe20KOqPN69","outputId":"b81dcd2a-9078-4a3d-a6b4-2add6dcc0488"},"outputs":[{"name":"stdout","output_type":"stream","text":["cp: cannot stat '/content/drive/MyDrive/MusicalMoods/Test_Dataset_CK+': No such file or directory\n"]}],"source":["!cp -r '/content/drive/MyDrive/MusicalMoods/Test_Dataset_CK+' Test_Dataset_CK+"]},{"cell_type":"code","execution_count":6,"metadata":{"colab":{"background_save":true},"executionInfo":{"elapsed":4,"status":"ok","timestamp":1651275202244,"user":{"displayName":"Rohit Dabas","userId":"03091092264887037162"},"user_tz":360},"id":"xOXRwXFm1cG-"},"outputs":[],"source":["def cnn_model():\n","  resnet_model = resnet50.ResNet50(include_top=True,weights='imagenet')\n","  \n","  model = Sequential()\n","  model.add(resnet_model)\n","  model.add(Flatten())\n","  model.add(BatchNormalization())\n","  model.add(Dense(1024,activation='relu'))\n","  model.add(Dropout(0.5))\n","  model.add(Dense(8, activation='softmax'))\n","  #model.compile(loss = 'sparse_categorical_crossentropy',optimizer='adam',metrics=['accuracy'])\n","  model.compile(optimizer='adam',loss = 'categorical_crossentropy', metrics=['accuracy'])\n","  model.summary()\n","  return model\n","\n","  "]},{"cell_type":"code","execution_count":7,"metadata":{"executionInfo":{"elapsed":3,"status":"ok","timestamp":1651275202244,"user":{"displayName":"Rohit Dabas","userId":"03091092264887037162"},"user_tz":360},"id":"5d5OSl2rzspf"},"outputs":[],"source":["from keras.preprocessing.image import ImageDataGenerator\n","\n","train_gen = ImageDataGenerator(\n","    rescale=1./255,\n","    rotation_range=30,\n","    shear_range=0.3,\n","    zoom_range=0.3,\n","    width_shift_range=0.4,\n","    height_shift_range=0.4,\n","    horizontal_flip=True,\n","    fill_mode='nearest'\n",")\n","\n","val_gen = ImageDataGenerator(rescale=1./255)"]},{"cell_type":"code","execution_count":8,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":407},"executionInfo":{"elapsed":518,"status":"error","timestamp":1651275202759,"user":{"displayName":"Rohit Dabas","userId":"03091092264887037162"},"user_tz":360},"id":"oFAFyUN20yOI","outputId":"7d2f4141-3102-4232-8fe1-d26383f88679"},"outputs":[{"ename":"FileNotFoundError","evalue":"ignored","output_type":"error","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mFileNotFoundError\u001b[0m                         Traceback (most recent call last)","\u001b[0;32m\u003cipython-input-8-4e415780c9dd\u003e\u001b[0m in \u001b[0;36m\u003cmodule\u003e\u001b[0;34m()\u001b[0m\n\u001b[1;32m      5\u001b[0m     \u001b[0mbatch_size\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;36m128\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      6\u001b[0m     \u001b[0mclass_mode\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;34m'categorical'\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----\u003e 7\u001b[0;31m     \u001b[0mshuffle\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;32mTrue\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      8\u001b[0m )\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/keras/preprocessing/image.py\u001b[0m in \u001b[0;36mflow_from_directory\u001b[0;34m(self, directory, target_size, color_mode, classes, class_mode, batch_size, shuffle, seed, save_to_dir, save_prefix, save_format, follow_links, subset, interpolation)\u001b[0m\n\u001b[1;32m    990\u001b[0m         \u001b[0mfollow_links\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mfollow_links\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    991\u001b[0m         \u001b[0msubset\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0msubset\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--\u003e 992\u001b[0;31m         interpolation=interpolation)\n\u001b[0m\u001b[1;32m    993\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    994\u001b[0m   def flow_from_dataframe(self,\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/keras/preprocessing/image.py\u001b[0m in \u001b[0;36m__init__\u001b[0;34m(self, directory, image_data_generator, target_size, color_mode, classes, class_mode, batch_size, shuffle, seed, data_format, save_to_dir, save_prefix, save_format, follow_links, subset, interpolation, dtype)\u001b[0m\n\u001b[1;32m    408\u001b[0m         \u001b[0msubset\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0msubset\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    409\u001b[0m         \u001b[0minterpolation\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0minterpolation\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--\u003e 410\u001b[0;31m         **kwargs)\n\u001b[0m\u001b[1;32m    411\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    412\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/keras_preprocessing/image/directory_iterator.py\u001b[0m in \u001b[0;36m__init__\u001b[0;34m(self, directory, image_data_generator, target_size, color_mode, classes, class_mode, batch_size, shuffle, seed, data_format, save_to_dir, save_prefix, save_format, follow_links, subset, interpolation, dtype)\u001b[0m\n\u001b[1;32m    113\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0;32mnot\u001b[0m \u001b[0mclasses\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    114\u001b[0m             \u001b[0mclasses\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;34m[\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--\u003e 115\u001b[0;31m             \u001b[0;32mfor\u001b[0m \u001b[0msubdir\u001b[0m \u001b[0;32min\u001b[0m \u001b[0msorted\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mos\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mlistdir\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mdirectory\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    116\u001b[0m                 \u001b[0;32mif\u001b[0m \u001b[0mos\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mpath\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0misdir\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mos\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mpath\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mjoin\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mdirectory\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0msubdir\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    117\u001b[0m                     \u001b[0mclasses\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mappend\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0msubdir\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mFileNotFoundError\u001b[0m: [Errno 2] No such file or directory: 'Dataset1'"]}],"source":["train_generator = train_gen.flow_from_directory(\n","    'Dataset1',\n","    color_mode='rgb',\n","    target_size=(128,128),\n","    batch_size=128,\n","    class_mode='categorical',\n","    shuffle=True\n",")"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":6,"status":"aborted","timestamp":1651275202756,"user":{"displayName":"Rohit Dabas","userId":"03091092264887037162"},"user_tz":360},"id":"8CBrYBXLNI-R"},"outputs":[],"source":["val_generator = val_gen.flow_from_directory(\n","    'Val_Dataset_CK+',\n","    color_mode='rgb',\n","    target_size=(128,128),\n","    batch_size=128,\n","    class_mode='categorical',\n","    shuffle=True\n",")"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":7,"status":"aborted","timestamp":1651275202757,"user":{"displayName":"Rohit Dabas","userId":"03091092264887037162"},"user_tz":360},"id":"AlWzH2C5QJ72"},"outputs":[],"source":["from keras.callbacks import ModelCheckpoint\n","ckeck_callback = ModelCheckpoint(\n","    '/content/drive/MyDrive/MusicalMoods/Emotion_model.h5',\n","    monitor='val_loss',\n","    mode='min',\n","    save_best_only=True,\n","    save_freq='epoch' \n",")"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":8,"status":"aborted","timestamp":1651275202758,"user":{"displayName":"Rohit Dabas","userId":"03091092264887037162"},"user_tz":360},"id":"TcuG2XOTRttA"},"outputs":[],"source":["from keras.callbacks import ReduceLROnPlateau\n","lr=ReduceLROnPlateau(\n","    monitor='val_loss',\n","    factor=0.2,\n","    patience=3,\n","    verbose=1,\n","    min_delta=0.0001\n","    )"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":8,"status":"aborted","timestamp":1651275202758,"user":{"displayName":"Rohit Dabas","userId":"03091092264887037162"},"user_tz":360},"id":"7WtpnT11SU81"},"outputs":[],"source":["from keras import callbacks\n","callbacks=[ckeck_callback,lr]"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":8,"status":"aborted","timestamp":1651275202759,"user":{"displayName":"Rohit Dabas","userId":"03091092264887037162"},"user_tz":360},"id":"DldcznSoe04c"},"outputs":[],"source":["model = cnn_model()\n","history = model.fit_generator(train_generator,epochs=50,callbacks=callbacks,verbose=1,validation_data=val_generator)\n","#history = model.fit(x_train,y_train,validation_split=0.20,batch_size=10,epochs=10,verbose=1)"]}],"metadata":{"colab":{"name":"Copy of TrainEmotionRecognition","provenance":[{"file_id":"1f1hVBoev-2iPSXzXO0a74LwdflvY6ZnZ","timestamp":1651207430117}],"version":""},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}